SELECT C.NOME, 
	   C.VALOR, 
	   C.HORAS, 
	   IFNULL(P.NOME,"---") AS PREREQ
FROM CURSOS C
LEFT JOIN CURSOS P
ON P.IDCURSO = C.ID_PREREQ;

CREATE DATABASE CURSORES;
USE CURSORES;

CREATE TABLE VENDEDORES(
	IDVENDEDOR INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(50),
	JAN INT,
	FEV INT,
	MAR INT
);

INSERT INTO VENDEDORES VALUES(NULL,"MAFRA", 34323,23243,54542);
INSERT INTO VENDEDORES VALUES(NULL,"CLARA",121223,4234232,324223);
INSERT INTO VENDEDORES VALUES(NULL,"JESUS", 54454,454545,78878);
INSERT INTO VENDEDORES VALUES(NULL,"BENTO", 121343,67454,345343);
INSERT INTO VENDEDORES VALUES(NULL,"DEUS", 123123,45454,12576);
INSERT INTO VENDEDORES VALUES(NULL,"MAOME", 21122,454523,123543);

SELECT * FROM VENDEDORES;

SELECT NOME, (JAN+FEV+MAR) AS TOTAL FROM VENDEDORES;
SELECT NOME, (JAN+FEV+MAR) AS TOTAL, (JAN+FEV+MAR)/3 AS MEDIA FROM VENDEDORES;

CREATE TABLE VEND_TOTAL(
	NOME VARCHAR(50),
	JAN INT,
	FEV INT,
	MAR INT,
	TOTAL INT,
	MEDIA INT
);

DELIMITER $

CREATE PROCEDURE INSEREDADOS()
BEGIN
		DECLARE FIM INT DEFAULT 0;
		DECLARE VAR1, VAR2, VAR3, VTOTAL, VMEDIA INT;
		DECLARE VNOME VARCHAR(50);

		DECLARE REG CURSOR FOR(
			SELECT NOME, JAN, FEV, MAR FROM VENDEDORES
			);

		DECLARE CONTINUE HANDLER FOR NOT FOUND SET FIM = 1;

		OPEN REG;

		REPEAT

			FETCH REG INTO VNOME, VAR1, VAR2, VAR3;
			IF NOT FIM THEN
				SET VTOTAL = VAR1 + VAR2 + VAR3;
				SET VMEDIA = VTOTAL/3;

				INSERT INTO VEND_TOTAL VALUES(VNOME, VAR1,VAR2,VAR3,VTOTAL,VMEDIA);
			END IF;

		UNTIL FIM END REPEAT;

		CLOSE REG;

END
$

DELIMITER ;

SELECT * FROM VENDEDORES;
SELECT * FROM VEND_TOTAL;

CALL INSEREDADOS ();
